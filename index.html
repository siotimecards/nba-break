<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>NBA Breaks - Choix √©quipe</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f7f7f7; margin:0; padding:20px; color:#111; }
    h1 { margin: 10px 0 6px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap: 12px; max-width:1100px; margin: 12px auto; }
    .team { cursor: pointer; background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); transition: transform .12s, box-shadow .12s; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .team img { width:72px; height:72px; object-fit:contain; }
    .team:hover { transform: translateY(-4px); box-shadow: 0 6px 16px rgba(0,0,0,0.12); }
    .team .name { font-weight:600; font-size:14px; }
    .team .price { font-size:13px; color:#666; }
    .taken { opacity:0.35; pointer-events:none; filter:grayscale(40%); }
    #controls { max-width:1100px; margin: 6px auto 18px; display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap; }
    #timer { font-weight:700; }
    #recap { max-width:1100px; margin:18px auto; text-align:left; background:#fff; padding:12px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.06); }
    .recap-item { display:flex; align-items:center; gap:10px; padding:6px 0; border-bottom:1px solid #f0f0f0; }
    .recap-item img { width:40px; height:40px; object-fit:contain; }
    #contact { margin-top:14px; font-size:15px; }
    #contact a { text-decoration:none; margin:0 8px; font-weight:600; color:#0a66c2; }
    button { background:#0a66c2; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
    button:disabled { opacity:0.5; cursor:not-allowed; }
    @media (max-width:500px){ .team img{width:60px;height:60px} }
  </style>
</head>
<body>
  <h1>NBA Breaks - Choisis ton √©quipe</h1>

  <div id="controls">
    <div>
      <span id="statusText">Inscriptions ouvertes</span>
      &nbsp;‚Ä¢&nbsp;
      <span id="takenCount">0</span>/<span id="totalTeams">30</span> prises
    </div>
    <div>
      <span id="timer">Chargement timer...</span>
      &nbsp;&nbsp;
      <button id="refreshRecapBtn">Rafra√Æchir r√©cap</button>
    </div>
  </div>

  <div class="grid" id="teams"></div>

  <div id="recap">
    <h2>R√©capitulatif des inscrits</h2>
    <div id="recapList">Chargement...</div>
  </div>

  <div id="contact">
    üì± Suivez-nous : 
    <a href="https://youtube.com/@SioTime?sub_confirmation=1/" target="_blank">YouTube</a> |
    <a href="https://instagram.com/siotime.cards/" target="_blank">Instagram</a> |
    <a href="https://x.com/Siotimecards/" target="_blank">X</a>
  </div>

  <script>
    // ============================
    // CONFIG - remplace l'URL par ton endpoint Apps Script d√©ploy√©
    // ============================
    const endpoint = "https://script.google.com/macros/s/AKfycby2Zsg6W2UU4d4STEPHrFqPEORkG-QdF9vxqXqBlvXRrHYKeL_5uk5fpi4o4sKXuOfb/exec";
    // D√©finis la date/heure de fin des inscriptions (format ISO) :
    // Exemple : YYYY-MM-DDTHH:MM:SS (heure locale). Modifie ensuite si besoin.
    const deadlineISO = "2025-10-15T20:00:00"; // <-- mets ta date/heure de fin ici

    // ============================
    // Donn√©es √©quipes (ajoute/modifie le champ price si besoin)
    // ============================
    const teams = [
      {name:"Atlanta Hawks", logo:"https://a.espncdn.com/i/teamlogos/nba/500/atl.png", price:"5‚Ç¨"},
      {name:"Boston Celtics", logo:"https://a.espncdn.com/i/teamlogos/nba/500/bos.png", price:"5‚Ç¨"},
      {name:"Brooklyn Nets", logo:"https://a.espncdn.com/i/teamlogos/nba/500/bkn.png", price:"5‚Ç¨"},
      {name:"Charlotte Hornets", logo:"https://a.espncdn.com/i/teamlogos/nba/500/cha.png", price:"5‚Ç¨"},
      {name:"Chicago Bulls", logo:"https://a.espncdn.com/i/teamlogos/nba/500/chi.png", price:"5‚Ç¨"},
      {name:"Cleveland Cavaliers", logo:"https://a.espncdn.com/i/teamlogos/nba/500/cle.png", price:"5‚Ç¨"},
      {name:"Dallas Mavericks", logo:"https://a.espncdn.com/i/teamlogos/nba/500/dal.png", price:"5‚Ç¨"},
      {name:"Denver Nuggets", logo:"https://a.espncdn.com/i/teamlogos/nba/500/den.png", price:"5‚Ç¨"},
      {name:"Detroit Pistons", logo:"https://a.espncdn.com/i/teamlogos/nba/500/det.png", price:"5‚Ç¨"},
      {name:"Golden State Warriors", logo:"https://a.espncdn.com/i/teamlogos/nba/500/gs.png", price:"5‚Ç¨"},
      {name:"Houston Rockets", logo:"https://a.espncdn.com/i/teamlogos/nba/500/hou.png", price:"5‚Ç¨"},
      {name:"Indiana Pacers", logo:"https://a.espncdn.com/i/teamlogos/nba/500/ind.png", price:"5‚Ç¨"},
      {name:"LA Clippers", logo:"https://a.espncdn.com/i/teamlogos/nba/500/lac.png", price:"5‚Ç¨"},
      {name:"LA Lakers", logo:"https://a.espncdn.com/i/teamlogos/nba/500/lal.png", price:"5‚Ç¨"},
      {name:"Memphis Grizzlies", logo:"https://a.espncdn.com/i/teamlogos/nba/500/mem.png", price:"5‚Ç¨"},
      {name:"Miami Heat", logo:"https://a.espncdn.com/i/teamlogos/nba/500/mia.png", price:"5‚Ç¨"},
      {name:"Milwaukee Bucks", logo:"https://a.espncdn.com/i/teamlogos/nba/500/mil.png", price:"5‚Ç¨"},
      {name:"Minnesota Timberwolves", logo:"https://a.espncdn.com/i/teamlogos/nba/500/min.png", price:"5‚Ç¨"},
      {name:"New Orleans Pelicans", logo:"https://a.espncdn.com/i/teamlogos/nba/500/no.png", price:"5‚Ç¨"},
      {name:"New York Knicks", logo:"https://a.espncdn.com/i/teamlogos/nba/500/ny.png", price:"5‚Ç¨"},
      {name:"Oklahoma City Thunder", logo:"https://a.espncdn.com/i/teamlogos/nba/500/okc.png", price:"5‚Ç¨"},
      {name:"Orlando Magic", logo:"https://a.espncdn.com/i/teamlogos/nba/500/orl.png", price:"5‚Ç¨"},
      {name:"Philadelphia 76ers", logo:"https://a.espncdn.com/i/teamlogos/nba/500/phi.png", price:"5‚Ç¨"},
      {name:"Phoenix Suns", logo:"https://a.espncdn.com/i/teamlogos/nba/500/phx.png", price:"5‚Ç¨"},
      {name:"Portland Trail Blazers", logo:"https://a.espncdn.com/i/teamlogos/nba/500/por.png", price:"5‚Ç¨"},
      {name:"Sacramento Kings", logo:"https://a.espncdn.com/i/teamlogos/nba/500/sac.png", price:"5‚Ç¨"},
      {name:"San Antonio Spurs", logo:"https://a.espncdn.com/i/teamlogos/nba/500/sa.png", price:"5‚Ç¨"},
      {name:"Toronto Raptors", logo:"https://a.espncdn.com/i/teamlogos/nba/500/tor.png", price:"5‚Ç¨"},
      {name:"Utah Jazz", logo:"https://a.espncdn.com/i/teamlogos/nba/500/utah.png", price:"5‚Ç¨"},
      {name:"Washington Wizards", logo:"https://a.espncdn.com/i/teamlogos/nba/500/wsh.png", price:"5‚Ç¨"}
    ];

    // ============================
    // Rendu des √©quipes
    // ============================
    const container = document.getElementById("teams");
    document.getElementById("totalTeams").innerText = teams.length;

    teams.forEach(team => {
      const div = document.createElement("div");
      div.className = "team";
      div.setAttribute("data-team", team.name);
      div.innerHTML = `
        <img src="${team.logo}" alt="${team.name}">
        <div class="name">${team.name}</div>
        <div class="price">${team.price}</div>
      `;

      div.onclick = () => onTeamClick(div, team);
      container.appendChild(div);
    });

    // ============================
    // Quand on clique sur une √©quipe
    // ============================
    function onTeamClick(div, team) {
      // Confirmation du choix d'√©quipe
      const confirmTeam = confirm("Tu as choisi l'√©quipe :\n\n" + team.name + "\n\nConfirmer ?");
      if (!confirmTeam) return;

      // Demande pseudo
      const pseudo = prompt("Entre ton pseudo (celui qui sera affich√© dans le r√©cap) :");
      if (!pseudo) return;

      // Demande r√©seau social (stock√© mais non affich√© publiquement)
      const social = prompt("Quel est ton pseudo / lien sur ton r√©seau social (ex: Insta, X) ?\n(sera stock√© mais non visible publiquement)");
      if (!social) return;

      // Envoi au serveur (Apps Script)
      fetch(endpoint, {
        method: "POST",
        body: JSON.stringify({ pseudo: pseudo, social: social, team: team.name })
      })
      .then(res => res.json())
      .then(json => {
        if (json.status && json.status === "error") {
          alert("Erreur serveur : " + json.message);
          return;
        }
        alert("‚úÖ Inscription envoy√©e pour " + team.name);
        div.classList.add("taken");
        updateTakenCount();
        loadRecap(); // mettre √† jour le r√©cap direct
      })
      .catch(err => {
        alert("‚ùå Erreur en envoyant l'inscription : " + err);
      });
    }

    // ============================
    // Charger les √©quipes d√©j√† prises
    // ============================
    async function loadTakenTeams() {
      try {
        const res = await fetch(endpoint + "?mode=taken");
        const taken = await res.json();
        // taken est un tableau de noms d'√©quipes
        const uniqueTaken = [...new Set(taken)]; // unique
        uniqueTaken.forEach(teamName => {
          const div = document.querySelector(`[data-team="${teamName}"]`);
          if (div) div.classList.add("taken");
        });
        updateTakenCount();
      } catch(err) {
        console.error("Erreur loadTakenTeams:", err);
      }
    }

    function updateTakenCount() {
      const taken = document.querySelectorAll(".team.taken").length;
      document.getElementById("takenCount").innerText = taken;
    }

    // ============================
    // R√©cap (logo + pseudo uniquement)
    // ============================
    async function loadRecap() {
      const listEl = document.getElementById("recapList");
      listEl.innerHTML = "Chargement...";
      try {
        const res = await fetch(endpoint + "?mode=recap");
        const rows = await res.json(); // [{pseudo, social, team, date}, ...]
        if (!rows || rows.length === 0) {
          listEl.innerHTML = "<i>Aucune inscription pour le moment</i>";
          return;
        }
        // trier par date ascendante (optionnel)
        rows.sort((a,b)=> new Date(a.date) - new Date(b.date));
        listEl.innerHTML = "";
        rows.forEach(item => {
          const teamData = teams.find(t => t.name === item.team);
          if (!teamData) return;
          const div = document.createElement("div");
          div.className = "recap-item";
          div.innerHTML = `<img src="${teamData.logo}" alt="${teamData.name}"><div><strong>${item.pseudo}</strong><div style="font-size:12px;color:#666">${teamData.name}</div></div>`;
          listEl.appendChild(div);
        });
      } catch(err) {
        console.error("Erreur loadRecap:", err);
        listEl.innerHTML = "<i>Impossible de charger le r√©cap.</i>";
      }
    }

    // Bouton rafra√Æchir r√©cap
    document.getElementById("refreshRecapBtn").addEventListener("click", loadRecap);

    // ============================
    // Timer d'inscription
    // ============================
    const timerEl = document.getElementById("timer");
    const statusTextEl = document.getElementById("statusText");
    let deadline = new Date(deadlineISO);

    function updateTimer() {
      const now = new Date();
      const diff = deadline - now;
      if (diff <= 0) {
        timerEl.innerText = "Inscriptions termin√©es";
        statusTextEl.innerText = "Inscriptions ferm√©es";
        // D√©sactiver toutes les √©quipes (les rendre non cliquables)
        document.querySelectorAll(".team").forEach(d => d.classList.add("taken"));
        return;
      }
      const days = Math.floor(diff / (1000*60*60*24));
      const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      const minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
      const seconds = Math.floor((diff % (1000*60)) / 1000);
      timerEl.innerText = `${days}j ${hours}h ${minutes}m ${seconds}s`;
    }

    // ============================
    // Initialisation
    // ============================
    loadTakenTeams();
    loadRecap();
    updateTimer();
    setInterval(updateTimer, 1000);

    // Optionnel : rafraichir takenTeams r√©guli√®rement (tous les 10s) pour voir prises r√©centes
    setInterval(loadTakenTeams, 10000);

  </script>
</body>
</html>
